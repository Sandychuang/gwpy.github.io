<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GWpy Example: measuring a transfer function &mdash; GWpy 0.1a4 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="//gwpy.github.io/css/gwpy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gwpy-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1a4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="top" title="GWpy 0.1a4 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GWpy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1a4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="index.html">Examples</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a href="../index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">What is GWpy?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">How do I install GWpy?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">What should I do first?</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../time/index.html">Times and timestamps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detector/channel.html">The <tt class="docutils literal"><span class="pre">Channel</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseries/index.html">The <tt class="docutils literal"><span class="pre">TimeSeries</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../spectrum/index.html">The <tt class="docutils literal"><span class="pre">Spectrum</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../spectrogram/index.html">The <tt class="docutils literal"><span class="pre">Spectrogram</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../segments/index.html">Data-quality segments</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../timeseries/statevector.html">The <tt class="docutils literal"><span class="pre">StateTimeSeries</span></tt> and <tt class="docutils literal"><span class="pre">StateVector</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../table/index.html">Tabular data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plotter/index.html">Plotting in GWpy (<tt class="docutils literal"><span class="pre">gwpy.plotter</span></tt>)</a></li>
</ul>
<ul class="simple">
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">GWpy Example: measuring a transfer function</a><ul>
<li><a class="reference internal" href="#problem">Problem</a></li>
<li><a class="reference internal" href="#solution">Solution</a></li>
</ul>
</li>
</ul>

<div id="sourcelink">
  <a href="../_sources/examples/gw_ex_plot_transfer_function.txt"
     rel="nofollow">Source</a>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="gwpy-example-measuring-a-transfer-function">
<h1>GWpy Example: measuring a transfer function<a class="headerlink" href="#gwpy-example-measuring-a-transfer-function" title="Permalink to this headline">¶</a></h1>
<div class="section" id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Permalink to this headline">¶</a></h2>
<p>I would like to study how ground motion is mitigated by the HEPI
active seismic isolation system.</p>
</div>
<div class="section" id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h2>
<p>First up, we import everything we&#8217;re going to need:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gwpy.time</span> <span class="kn">import</span> <span class="n">tconvert</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gwpy.timeseries</span> <span class="kn">import</span> <span class="n">TimeSeriesDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gwpy.plotter</span> <span class="kn">import</span> <span class="n">BodePlot</span>
</pre></div>
</div>
<p>Next we can set the times and the channels we need:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">start</span> <span class="o">=</span> <span class="n">tconvert</span><span class="p">(</span><span class="s">&#39;May 27 2014 04:00&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1800</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gndchannel</span> <span class="o">=</span> <span class="s">&#39;L1:ISI-GND_STS_ITMY_Z_DQ&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hpichannel</span> <span class="o">=</span> <span class="s">&#39;L1:HPI-ITMY_BLND_L4C_Z_IN1_DQ&#39;</span>
</pre></div>
</div>
<p>Now we can dowload the data using the
<a class="reference internal" href="../timeseries/index.html#gwpy.timeseries.TimeSeriesDict.fetch" title="gwpy.timeseries.TimeSeriesDict.fetch"><tt class="xref py py-meth docutils literal"><span class="pre">TimeSeriesDict.fetch()</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">TimeSeriesDict</span><span class="o">.</span><span class="n">fetch</span><span class="p">([</span><span class="n">gndchannel</span><span class="p">,</span> <span class="n">hpichannel</span><span class="p">],</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gnd</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">gndchannel</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gnd</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Before HEPI (ground)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hpi</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">hpichannel</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hpi</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;After HEPI&#39;</span>
</pre></div>
</div>
<p>At this point it is useful to take a quick look at the amplitude spectral
densities of each of the two signals:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gndasd</span> <span class="o">=</span> <span class="n">gnd</span><span class="o">.</span><span class="n">asd</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hpiasd</span> <span class="o">=</span> <span class="n">hpi</span><span class="o">.</span><span class="n">asd</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">asdplot</span> <span class="o">=</span> <span class="n">gndasd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">asdplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hpiasd</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;Seismic motion [nm/s/$\sqrt{\mathrm{Hz}}$]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">3e3</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/gw_ex_plot_transfer_function_asds.py">Source code</a>, <a class="reference external" href="../examples/gw_ex_plot_transfer_function_asds.png">png</a>)</p>
<div class="figure">
<img alt="../_images/gw_ex_plot_transfer_function_asds.png" src="../_images/gw_ex_plot_transfer_function_asds.png" />
</div>
<p>Now, in order to calculate the transfer function, we need to calculate an
averaged Fourier transform of each <a class="reference internal" href="../timeseries/index.html#gwpy.timeseries.TimeSeries" title="gwpy.timeseries.TimeSeries"><tt class="xref py py-class docutils literal"><span class="pre">TimeSeries</span></tt></a>.
Desiring 0.01 Hz resolution, we use a 100-second FFT, with 50%
overlap (specified in seconds):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gndfft</span> <span class="o">=</span> <span class="n">gnd</span><span class="o">.</span><span class="n">average_fft</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s">&#39;hamming&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hpifft</span> <span class="o">=</span> <span class="n">hpi</span><span class="o">.</span><span class="n">average_fft</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s">&#39;hamming&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can simply calculate the transfer function by dividing the output
signal (the HEPI data) by the input signal (the ground motion data), taking
care because the two data channels may be recorded at different rates (meaning
their FFTs will have different sizes):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gndfft</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">hpifft</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tf</span> <span class="o">=</span> <span class="n">hpifft</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span> <span class="o">/</span> <span class="n">gndfft</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span>
</pre></div>
</div>
<p>And now we can plot the result as a <a class="reference internal" href="../plotter/api.html#gwpy.plotter.BodePlot" title="gwpy.plotter.BodePlot"><tt class="xref py py-class docutils literal"><span class="pre">BodePlot</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span> <span class="o">=</span> <span class="n">BodePlot</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">magax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">magax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">r&#39;L1 ITMY ground $\rightarrow$ HPI transfer function&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../../examples/gw_ex_plot_transfer_function.py">Source code</a>, <a class="reference external" href="../../examples/gw_ex_plot_transfer_function.png">png</a>)</p>
<div class="figure">
<img alt="../_images/gw_ex_plot_transfer_function.png" src="../_images/gw_ex_plot_transfer_function.png" />
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Duncan Macleod.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>